{
    "uri": "/run",
    "upstream": {
        "type": "roundrobin",
        "nodes": {
            "httpbin.org:443": 1
        },
        "scheme": "https"
    },
    "plugins": {
        "serverless-pre-function": {
            "phase": "rewrite",
            "functions": [
                "local cjson = require 'cjson'\n\n-- Simple working function that processes XML to JSON\nngx.log(ngx.INFO, '=== RUN ROUTE FUNCTION STARTED ===')\n\n-- Get request body if it exists\nngx.req.read_body()\nlocal xml_body = ngx.req.get_body_data()\n\nif xml_body then\n    ngx.log(ngx.INFO, 'Received XML: ', xml_body)\n    \n    -- Simple XML parsing\n    local user = {}\n    local name = xml_body:match('<name>([^<]+)</name>')\n    local email = xml_body:match('<email>([^<]+)</email>')\n    local age = xml_body:match('<age>([^<]+)</age>')\n    \n    if name then user.name = name end\n    if email then user.email = email end\n    if age then user.age = tonumber(age) or age end\n    \n    -- Convert to JSON\n    local json_result = cjson.encode(user)\n    \n    -- Print the conversion\n    ngx.log(ngx.INFO, '=== XML TO JSON CONVERSION ===')\n    ngx.log(ngx.INFO, 'Original XML: ', xml_body)\n    ngx.log(ngx.INFO, 'Converted JSON: ', json_result)\n    ngx.log(ngx.INFO, '=== END CONVERSION ===')\n    \n    -- Set response headers\n    ngx.header['X-Original-XML'] = xml_body\n    ngx.header['X-Converted-JSON'] = json_result\n    \n    -- Update request body with JSON\n    ngx.req.set_body_data(json_result)\n    ngx.req.set_header('Content-Type', 'application/json')\nelse\n    -- No body, return simple response\n    ngx.log(ngx.INFO, 'No request body received')\n    local response = {message = 'Hello from /run route!', timestamp = ngx.time()}\n    ngx.req.set_body_data(cjson.encode(response))\n    ngx.req.set_header('Content-Type', 'application/json')\nend\n\nngx.log(ngx.INFO, '=== RUN ROUTE FUNCTION COMPLETED ===')"
            ]
        }
    }
}
